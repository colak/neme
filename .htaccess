#neme2.4

ErrorDocument 403 https://www.neme.org/forbidden.html

<FilesMatch "^(forbidden\.html|robots\.txt)$">
Require all granted
</FilesMatch>

# block bad bots
BrowserMatchNoCase "12soso|AspiegelBot|Baiduspider|Bytespider|Datanyze|Kinza|LieBaoFast|Mb2345Browser|MicroMessenger|SemrushBot|Sogou|adscanner|claudebot|libwww-perl|serpstatbot|spaziodat|undefined|wget|zh-CN|zh_CN" bad_bot

# Block bad actors and bots
<RequireAll>
Require all granted
Require not ip 217.147.172.206
# Require not ip 34.174
# Require not ip 34.174.0.0/16
Require not env bad_bot
</RequireAll>

<If "%{REMOTE_ADDR} =~ /^34\.174\.\d{1,3}\.\d{1,3}/">
Require all denied
</If>

# The following require custom modules to be installed
# <IfModule mod_authz_core.c>
# Require all granted
# Require not ip 34.174
# </IfModule>

#<IfModule mod_bw.c>
# <If "%{REMOTE_ADDR} =~ /^34\.174\./">
# Set bandwidth limit in KB/sec.
# BandwidthLimit 10
# </If>
# </IfModule>

# <IfModule mod_qos.c>
# QS_LimitBandwidth 34.174.0.0/16 100
# </IfModule>

# prevent DoS attacks by limiting the bandwidth
# <IfModule ratelimit_module>
# SetOutputFilter RATE_LIMIT
# SetEnv rate-limit 50
# SetEnv rate-initial-burst 200
# </IfModule>

# Only uncomment if you have issues with posing articles or templates
# SecFilterEngine Off
# SecFilterScanPOST Off

# CSP
<IfModule mod_headers.c>
Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS
Header set Content-Security-Policy "frame-ancestors 'self'"
Header set X-Content-Type-Options "nosniff"
Header set Cross-Origin-Resource-Policy "same-origin"
Header set Permissions-Policy "accelerometer=(), autoplay=(), camera=(self), display-capture=(), encrypted-media=(), fullscreen=(self '*.vimeo.com' '*.youtube.com'), geolocation=(), gyroscope=(), idle-detection=(), magnetometer=(), microphone=(), midi=(), payment=(), picture-in-picture=(), publickey-credentials-get=(), clipboard-read=(), screen-wake-lock=(), sync-xhr=(self), usb=(), xr-spatial-tracking=()"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header set Expect-CT "max-age=86400, enforce"
Header set Referrer-Policy "same-origin"
</IfModule>

# compression
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE "(application/(javascript|rss\+xml|x-font|x-font-opentype|x-font-otf|x-font-truetype|x-font-ttf)|font/(opentype|otf|ttf)|image/svg\+xml|image/x-icon|text/(css|html|javascript|plain|xml)|application/xml)"
# Browser bug fixes
BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4\.0[678] no-gzip
BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
Header append Vary User-Agent
</IfModule>

# cache control
<IfModule mod_expires.c>
ExpiresActive On
ExpiresByType image/jpg "access plus 1 year"
ExpiresByType image/jpeg "access plus 1 year"
ExpiresByType image/webp "access plus 1 year"
ExpiresByType image/gif "access plus 1 year"
ExpiresByType image/png "access plus 1 year"
ExpiresByType text/css "access plus 10 days"
ExpiresByType text/html "access plus 1 month"
ExpiresByType application/pdf "access plus 1 month"
ExpiresByType application/javascript "access plus 1 month"
ExpiresByType application/x-javascript "access plus 1 month"
ExpiresByType text/javascript "access plus 1 month"
ExpiresByType image/x-icon "access plus 1 month"
ExpiresByType image/svg+xml "access 1 month"
ExpiresByType application/atom+xml "access plus 1 hour"
ExpiresByType application/rss+xml "access plus 1 hour"
ExpiresDefault "access plus 1 month"
</IfModule>

# redirects any non-www HTTP or HTTPS
RewriteCond %{HTTP_HOST} !^$
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteCond %{HTTPS}s ^on(s)|
RewriteRule ^ http%1://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# redirects old urls to new urls
RewriteEngine On
RewriteRule ^main/?(.*)$ https://www.neme.org/$1 [R=301,L]
RewriteRule ^forum/?(.*)$ http://forum.neme.org/$1 [R=301,L]
RewriteRule ^reblog/out/?$ https://www.neme.org/ [R=301,L]
RewriteRule ^arts_info/?$ /blog/ [R=301,L]
RewriteRule ^archives/?$ /blog/?_NeMe_redirected=1  [R=301,L]
RewriteRule ^archives(20\d{2})/?$ /blog/?_NeMe_redirected=1 [R=301,L]
RewriteRule ^publications/cited/citations/?$ https://www.neme.org/publications/cited/ [R=301,L]
RewriteRule ^publications/mentioned/mentions/?$ https://www.neme.org/publications/mentioned/ [R=301,L]
RewriteRule ^blog//non-machines/?$ https://www.neme.org/projects/participations/non-machines?_NeMe_redirected=1 [R=301,L]
RewriteRule ^blog/short-matters/?$ https://www.neme.org/projects/hosted/short-matters?_NeMe_redirected=1 [R=301,L]
RewriteRule ^496/27-bienal-de-sao-paulo/?$ https://www.neme.org/blog/27-bienal-de-sao-paulo?_NeMe__NeMe_redirected=1 [R=301,L]
RewriteRule ^blog/newport-beach-film-festival-2009/?$ /blog/nbff-2009?_NeMe_redirected=1 [R=301,L]
RewriteRule ^250/?$ https://www.neme.org/texts/from-zombie-to-cyborg?_NeMe_redirected=1 [R=301,L]
RewriteRule ^calls/?$ https://www.neme.org/blog/ [R=301,L]
RewriteRule ^1721/pq-2015/?$ https://www.neme.org/texts/from-zombie-to-cyborg?_NeMe_redirected=1 [R=301,L]
RewriteRule ^category/calls/?$ /blog/?_NeMe_redirected=1 [R=301,L]
RewriteRule ^category/intransition/?$ /projects/in-transition-cyprus-2006?_NeMe_redirected=1 [R=301,L]
RewriteRule ^category/ideodrome2006/?$ /projects/ideodrome-2006?_NeMe_redirected=1 [R=301,L]
RewriteRule ^article/?$ /texts/?_NeMe_redirected=1 [R=301,L]
RewriteRule ^call/?$ /blog/?_NeMe_redirected=1 [R=301,L]
RewriteRule ^(\d+)/([\w\-]+)$ /texts/$2?_NeMe_redirected=1 [R=301,L]
RewriteRule ^texts/open-city-stepping-in-from-the-edge/?$ /texts/open-city?_NeMe_redirected=1 [R=301,L]
RewriteRule ^texts/istanbul-biennial-10-nightcomers/?$ /blog/istanbul-biennial-10-nightcomers?_NeMe_redirected=1 [R=301,L]
RewriteRule ^texts/roc-14/?$ /blog/roc-14?_NeMe_redirected=1 [R=301,L]
RewriteRule ^571/preserving-new-media\.html/?$ /texts/preserving-new-media?_NeMe_redirected=1 [R=301,L]
RewriteRule ^texts/(open-city-stepping-in-from-the-edge|istanbul-biennial-10-nightcomers|roc-14|qed-saturday-12-october-2013|tive-2008|dok-leipzig-2010|performa-11|lisbon-architecture-triennale|female-shorts|idensitat-07|biacs2|24th-ube-biennale|untitled12th-istanbul-biennial-2011|tampere-xxxviii|facade-window-project|electric-renaissance-2005call|the-united-nations-plaza)/?$ /blog/$1?_NeMe_redirected=1 [R=301,L]
# Final catch-all for any URLs not matched (optional)
# RewriteRule ^.*$ / [R=301,L]

RewriteCond %{QUERY_STRING} (^|&)accept_cookies=yes(&|$)
RewriteRule ^(.*)$ /$1? [R=301,L]
RewriteCond %{QUERY_STRING} ^context=image(&p=\d+)?$
RewriteRule ^(.*)$ /$1? [R=301,L]
RewriteCond %{QUERY_STRING} ^m=\d+$
RewriteRule ^(.*)$ /$1? [R=301,L]

# block hackers
RewriteCond %{REQUEST_URI} (bbs|bigdump|bitrix|cgi|CHANGELOG|ckeditor|ckfinder|cms|connectors|connector|console|convert|dedecms|dede|drupal|dump|editor|elfinder|eshop|fallback|fckeditor|FileZilla|gaestebuch|gastenboek|guestbook|jomestate|joomla|kcfinder|lazycms|login|magmi|mail|manage|noscript|oecms|phpcms|plus|register|rob-chiu|templates|Tester|tinymce|trackback|udd|uploadTester|utility|webmail|webmanage|wordpress|wp-admin|wp-content|wp-login|wp|xmlrpc|ycportal) [NC]
RewriteRule .* - [F,L]

#DirectoryIndex index.php index.html

#Options +FollowSymLinks
#Options All -Indexes
Options -Indexes

RewriteCond %{QUERY_STRING} ^m\=any$- [NC]
RewriteCond %{QUERY_STRING} ^m\=any\&q=1$- [NC]
RewriteRule ^ - [F]

AddDefaultCharset utf-8

# BEGIN txp
<IfModule mod_rewrite.c>
RewriteEngine On
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

#RewriteBase /relative/web/path/
RewriteRule ^sitemap.xml$  index.php?s=sitemap [L]

RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(.+) - [PT,L]

RewriteCond %{REQUEST_URI} !=/favicon.ico
RewriteRule ^(.*) index.php

RewriteCond %{HTTP:Authorization}  !^$
RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization}]
</IfModule>

# SVG
<IfModule mod_mime.c>
AddType image/svg+xml  svg svgz
AddEncoding gzip       svgz
</IfModule>
# END txp

# Only work in httpd.conf
# ServerSignature Off
# turn off ipv6
# Listen 0.0.0.0:80

# These prevent web browsers or spiders from seeing sensitive documents
# prevent access to any file or directory starting with a .
RewriteCond %{SCRIPT_FILENAME} -d [OR]
RewriteCond %{SCRIPT_FILENAME} -f
RewriteRule "(^|/)\." - [F]

<FilesMatch "^(\.htaccess|config\.php|\.env)$">
Require all denied
</FilesMatch>
